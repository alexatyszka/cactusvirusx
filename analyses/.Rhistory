#install needed packages
install.packages('BiocManager')# This option gave B errors; repos=c('https://cran.rstudio.com'), ask=F)
library(ggtree) # tree plotting
library(DECIPHER)
BiocManager::install('DECIPHER')
BiocManager::install("ggtree")
BiocManager::install("phytools")
library(ggtree) # tree plotting
library(DECIPHER)
library(RCurl) # web page loading
library(phangorn)
library(phytools)
metadata.loc <- 'https://raw.githubusercontent.com/pseudocrater/cactusvirusx/master/data/meatdata.csv'
aln.fasta.loc <- 'https://raw.githubusercontent.com/pseudocrater/cactusvirusx/master/data/genbank_KR_viruses_aln.fasta'
aln.fasta.loc <- 'https://raw.githubusercontent.com/pseudocrater/cactusvirusx/master/data/genbank_KR_viruses_aln.fasta'
aln.fasta.loc
aln.fasta <- getURL(aln.fasta.loc)
aln.fasta
seq.metadata.csv <-getURL(metadata.loc)
write(x=seq.metadata.csv, file='seq.metadata.csv')
cvx.metadata <- read.csv('seq.metadata.csv', stringsAsFactors = FALSE)
View(cvx.metadata)
metadata.loc <- 'https://raw.githubusercontent.com/pseudocrater/cactusvirusx/master/data/meatdata_v2s.csv'
aln.fasta.loc <- 'https://raw.githubusercontent.com/pseudocrater/cactusvirusx/master/data/genbank_KR_viruses_aln_v2.fasta'
aln.fasta <- getURL(aln.fasta.loc)
seq.metadata.csv <-getURL(metadata.loc)
write(x=seq.metadata.csv, file='seq.metadata.csv')
cvx.metadata <- read.csv('seq.metadata.csv', stringsAsFactors = FALSE)
seq.metadata.csv <-getURL(metadata.loc)
seq.metadata.csv
metadata.loc <- 'https://raw.githubusercontent.com/pseudocrater/cactusvirusx/master/data/meatdata_v2.csv'
aln.fasta <- getURL(aln.fasta.loc)
seq.metadata.csv <-getURL(metadata.loc)
write(x=seq.metadata.csv, file='seq.metadata.csv')
cvx.metadata <- read.csv('seq.metadata.csv', stringsAsFactors = FALSE)
write(aln.fasta, file = 'aln.fasta')
aln.fasta
cacti.aln <- read.dna(file = 'aln.fasta', format= "fasta")
aln.phy <- read.phyDat('aln.fasta', format='fasta', type='DNA')
aln.bin <- as.DNAbin(aln.phy)
cacti.nj <- NJ(dist.dna(aln.bin))
cacti.njtree <- cacti.nj
plot.phylo(ladderize(cacti.njtree), type='phylo', no.margin=F, cex=0.5, label.offset=0.0025)
is.rooted(cacti.njtree)
cacti.nj$tip.label
sys.time
Sys.time()
filename = paste(gsub(":", "-", Sys.time()),"_names_hosts_nj.pdf",sep="")
filename
Sys.Date()
ggtree(nj.gg, ladderize=T, aes(), show.legend = TRUE) %<+% hosts.df %<+% df  +
#name tip labels:
geom_tiplab(aes(), hjust=0, offset=0, align=T, linetype = "dashed" )+
#host tip labels:
geom_tiplab(aes(label=hosts.df$hosts), align = T, linetype = 'blank',
na.rm=FALSE, offset=0.2) +
#scale
geom_treescale(x=0.05, y=25, offset=2, fontsize = 3)+
#numbered tip labels for checking data addition
#geom_tiplab(aes(label=c(1:179)), size= 2, align = T, linetype = 'blank',
#         na.rm=FALSE, offset=0.2) +
#display/check node labels:
#geom_text2(aes(subset=!isTip, label=node), hjust=-.3)+
#highlight specified node:
#geom_hilight(node=101,fill="yellow", alpha=.6)+
xlim(0,0.75)
ggtree(nj.gg, ladderize=T, aes(), show.legend = TRUE)+
#%<+% hosts.df %<+% df  +
#name tip labels:
geom_tiplab(aes(), hjust=0, offset=0, align=T, linetype = "dashed" )+
#host tip labels:
#  geom_tiplab(aes(label=hosts.df$hosts), align = T, linetype = 'blank',
#              na.rm=FALSE, offset=0.2) +
#scale
geom_treescale(x=0.05, y=25, offset=2, fontsize = 3)+
#numbered tip labels for checking data addition
#geom_tiplab(aes(label=c(1:179)), size= 2, align = T, linetype = 'blank',
#         na.rm=FALSE, offset=0.2) +
#display/check node labels:
#geom_text2(aes(subset=!isTip, label=node), hjust=-.3)+
#highlight specified node:
#geom_hilight(node=101,fill="yellow", alpha=.6)+
xlim(0,0.75)
unlink("aln.fasta")
unlink("seq.metadata.csv")
View(cvx.metadata)
filename = paste(gsub(":", "-", Sys.time()),"_names_hosts_nj.pdf",sep="")
ggsave(filename, width = 60, height = 40, units = "cm", limitsize = FALSE)
library(ggtree) # tree plotting
library(DECIPHER)
library(RCurl) # web page loading
library(phangorn)
library(phytools)
metadata.loc <- 'https://raw.githubusercontent.com/pseudocrater/cactusvirusx/master/data/meatdata_v3.csv'
aln.fasta.loc <- 'https://raw.githubusercontent.com/pseudocrater/cactusvirusx/master/data/genbank_KR_viruses_aln_v3.fasta'
aln.fasta <- getURL(aln.fasta.loc)
seq.metadata.csv <-getURL(metadata.loc)
write(x=seq.metadata.csv, file='seq.metadata.csv')
cvx.metadata <- read.csv('seq.metadata.csv', stringsAsFactors = FALSE)
#alphabetize metadata, only needs to be done once:
#cvx.metadata <- cvx.metadata[order(cvx.metadata$Name),]
write(x=seq.metadata.csv, file='seq.metadata.csv')
write(aln.fasta, file = 'aln.fasta')
cacti.aln <- read.dna(file = 'aln.fasta', format= "fasta")
aln.phy <- read.phyDat('aln.fasta', format='fasta', type='DNA')
aln.bin <- as.DNAbin(aln.phy)
function (x, model = "K80", variance = FALSE, gamma = FALSE,
pairwise.deletion = FALSE, base.freq = NULL, as.matrix = FALSE)
cacti.nj <- NJ(dist.dna(aln.bin))
cacti.njtree <- cacti.nj
cacti.njtree <- root(cacti.nj, outgroup=c(88:90), resolve.root=T)
is.rooted(cacti.njtree)
#plot.phylo(ladderize(cacti.njtree), type='phylo', no.margin=F, cex=0.5, label.offset=0.0025)
write.tree(cacti.njtree, file="cacti.njtree.nwk")
nj.gg <- read.tree(file="cacti.njtree.nwk")
#alphabetize metadata, only needs to be done once:
cvx.metadata <- cvx.metadata[order(cvx.metadata$Name),]
View(cvx.metadata)
write(x=seq.metadata.csv, file='seq.metadata.csv')
head(cvx.metadata$Name)
head(cacti.njtree$tip.label)
ggtree(nj.gg, ladderize=T, aes(), show.legend = TRUE)+
#%<+% hosts.df %<+% df  +
#name tip labels:
geom_tiplab(aes(), hjust=0, offset=0, align=T, linetype = "dashed" )+
#host tip labels:
#  geom_tiplab(aes(label=hosts.df$hosts), align = T, linetype = 'blank',
#              na.rm=FALSE, offset=0.2) +
#scale
geom_treescale(x=0.05, y=25, offset=2, fontsize = 3)+
#numbered tip labels for checking data addition
#geom_tiplab(aes(label=c(1:179)), size= 2, align = T, linetype = 'blank',
#         na.rm=FALSE, offset=0.2) +
#display/check node labels:
#geom_text2(aes(subset=!isTip, label=node), hjust=-.3)+
#highlight specified node:
#geom_hilight(node=101,fill="yellow", alpha=.6)+
xlim(0,0.75)
ggtree(nj.gg, ladderize=T, aes(), show.legend = TRUE)+
#%<+% hosts.df %<+% df  +
#name tip labels:
geom_tiplab(aes(label=cacti.aln), hjust=0, offset=0, align=T, linetype = "dashed" )+
#host tip labels:
#  geom_tiplab(aes(label=hosts.df$hosts), align = T, linetype = 'blank',
#              na.rm=FALSE, offset=0.2) +
#scale
geom_treescale(x=0.05, y=25, offset=2, fontsize = 3)+
#numbered tip labels for checking data addition
#geom_tiplab(aes(label=c(1:179)), size= 2, align = T, linetype = 'blank',
#         na.rm=FALSE, offset=0.2) +
#display/check node labels:
#geom_text2(aes(subset=!isTip, label=node), hjust=-.3)+
#highlight specified node:
#geom_hilight(node=101,fill="yellow", alpha=.6)+
xlim(0,0.75)
ggtree(nj.gg, ladderize=T, aes(), show.legend = TRUE)+
#%<+% hosts.df %<+% df  +
#name tip labels:
geom_tiplab(aes(label=cacti.njtree$tip.label), hjust=0, offset=0, align=T, linetype = "dashed" )+
#host tip labels:
#  geom_tiplab(aes(label=hosts.df$hosts), align = T, linetype = 'blank',
#              na.rm=FALSE, offset=0.2) +
#scale
geom_treescale(x=0.05, y=25, offset=2, fontsize = 3)+
#numbered tip labels for checking data addition
#geom_tiplab(aes(label=c(1:179)), size= 2, align = T, linetype = 'blank',
#         na.rm=FALSE, offset=0.2) +
#display/check node labels:
#geom_text2(aes(subset=!isTip, label=node), hjust=-.3)+
#highlight specified node:
#geom_hilight(node=101,fill="yellow", alpha=.6)+
xlim(0,0.75)
ggtree(nj.gg, ladderize=T, aes(), show.legend = TRUE)+
#%<+% hosts.df %<+% df  +
#name tip labels:
geom_tiplab(aes(label=), hjust=0, offset=0, align=T, linetype = "dashed" )+
#host tip labels:
#  geom_tiplab(aes(label=hosts.df$hosts), align = T, linetype = 'blank',
#              na.rm=FALSE, offset=0.2) +
#scale
geom_treescale(x=0.05, y=25, offset=2, fontsize = 3)+
#numbered tip labels for checking data addition
#geom_tiplab(aes(label=c(1:179)), size= 2, align = T, linetype = 'blank',
#         na.rm=FALSE, offset=0.2) +
#display/check node labels:
#geom_text2(aes(subset=!isTip, label=node), hjust=-.3)+
#highlight specified node:
#geom_hilight(node=101,fill="yellow", alpha=.6)+
xlim(0,0.75)
ggtree(nj.gg, ladderize=T, aes(), show.legend = TRUE)+
#%<+% hosts.df %<+% df  +
#name tip labels:
#geom_tiplab(aes(label=), hjust=0, offset=0, align=T, linetype = "dashed" )+
#host tip labels:
#  geom_tiplab(aes(label=hosts.df$hosts), align = T, linetype = 'blank',
#              na.rm=FALSE, offset=0.2) +
#scale
geom_treescale(x=0.05, y=25, offset=2, fontsize = 3)+
#numbered tip labels for checking data addition
#geom_tiplab(aes(label=c(1:179)), size= 2, align = T, linetype = 'blank',
#         na.rm=FALSE, offset=0.2) +
#display/check node labels:
#geom_text2(aes(subset=!isTip, label=node), hjust=-.3)+
#highlight specified node:
#geom_hilight(node=101,fill="yellow", alpha=.6)+
xlim(0,0.75)
#name tip labels:
#geom_tiplab(aes(label=), hjust=0, offset=0, align=T, linetype = "dashed" )+
#host tip labels:
geom_tiplab(aes(label=hosts.df$hosts), align = T, linetype = 'blank',
ggtree(nj.gg, ladderize=T, aes(), show.legend = TRUE)+
#%<+% hosts.df %<+% df  +
#name tip labels:
geom_tiplab(aes(label=), hjust=0, offset=0, align=T, linetype = "dashed" )+
#host tip labels:
#  geom_tiplab(aes(label=hosts.df$hosts), align = T, linetype = 'blank',
#              na.rm=FALSE, offset=0.2) +
#scale
geom_treescale(x=0.05, y=25, offset=2, fontsize = 3)+
#numbered tip labels for checking data addition
#geom_tiplab(aes(label=c(1:179)), size= 2, align = T, linetype = 'blank',
#         na.rm=FALSE, offset=0.2) +
#display/check node labels:
#geom_text2(aes(subset=!isTip, label=node), hjust=-.3)+
#highlight specified node:
#geom_hilight(node=101,fill="yellow", alpha=.6)+
xlim(0,0.75)
ggtree(nj.gg, ladderize=T, aes(), show.legend = TRUE)+
ggtree(nj.gg, ladderize=T, aes(), show.legend = TRUE)+
#%<+% hosts.df %<+% df  +
#name tip labels:
geom_tiplab()
par( mar=c(1, 1, 0, 1))
ggtree(nj.gg, ladderize=T, aes(), show.legend = TRUE)+
#%<+% hosts.df %<+% df  +
#name tip labels:
geom_tiplab()+
#geom_tiplab(aes(), hjust=0, offset=0, align=T, linetype = "dashed" )+
#host tip labels:
#  geom_tiplab(aes(label=hosts.df$hosts), align = T, linetype = 'blank',
#              na.rm=FALSE, offset=0.2) +
#scale
geom_treescale(x=0.05, y=25, offset=2, fontsize = 3)+
#numbered tip labels for checking data addition
#geom_tiplab(aes(label=c(1:179)), size= 2, align = T, linetype = 'blank',
#         na.rm=FALSE, offset=0.2) +
#display/check node labels:
#geom_text2(aes(subset=!isTip, label=node), hjust=-.3)+
#highlight specified node:
#geom_hilight(node=101,fill="yellow", alpha=.6)+
xlim(0,0.75)
ggtree(nj.gg, ladderize=T, aes(), show.legend = TRUE)+
#%<+% hosts.df %<+% df  +
#name tip labels:
geom_tiplab(cex=0.75)+
#geom_tiplab(aes(), hjust=0, offset=0, align=T, linetype = "dashed" )+
#host tip labels:
#  geom_tiplab(aes(label=hosts.df$hosts), align = T, linetype = 'blank',
#              na.rm=FALSE, offset=0.2) +
#scale
geom_treescale(x=0.05, y=25, offset=2, fontsize = 3)+
#numbered tip labels for checking data addition
#geom_tiplab(aes(label=c(1:179)), size= 2, align = T, linetype = 'blank',
#         na.rm=FALSE, offset=0.2) +
#display/check node labels:
#geom_text2(aes(subset=!isTip, label=node), hjust=-.3)+
#highlight specified node:
#geom_hilight(node=101,fill="yellow", alpha=.6)+
xlim(0,0.75)
filename = paste(gsub(":", "-", Sys.time()),"_names_hosts_nj.pdf",sep="")
ggsave(filename, width = 60, height = 40, units = "cm", limitsize = FALSE)
ggtree(nj.gg, ladderize=T, aes(), show.legend = TRUE)+
#%<+% hosts.df %<+% df  +
#name tip labels:
geom_tiplab(cex=0.8)+
#geom_tiplab(aes(), hjust=0, offset=0, align=T, linetype = "dashed" )+
#host tip labels:
#  geom_tiplab(aes(label=hosts.df$hosts), align = T, linetype = 'blank',
#              na.rm=FALSE, offset=0.2) +
#scale
geom_treescale(x=0.05, y=25, offset=2, fontsize = 3)+
#numbered tip labels for checking data addition
#geom_tiplab(aes(label=c(1:179)), size= 2, align = T, linetype = 'blank',
#         na.rm=FALSE, offset=0.2) +
#display/check node labels:
#geom_text2(aes(subset=!isTip, label=node), hjust=-.3)+
#highlight specified node:
#geom_hilight(node=101,fill="yellow", alpha=.6)+
xlim(0,0.75)
ggtree(nj.gg, ladderize=T, aes(), show.legend = TRUE)+
#%<+% hosts.df %<+% df  +
#name tip labels:
geom_tiplab(cex=0.9)+
#geom_tiplab(aes(), hjust=0, offset=0, align=T, linetype = "dashed" )+
#host tip labels:
#  geom_tiplab(aes(label=hosts.df$hosts), align = T, linetype = 'blank',
#              na.rm=FALSE, offset=0.2) +
#scale
geom_treescale(x=0.05, y=25, offset=2, fontsize = 3)+
#numbered tip labels for checking data addition
#geom_tiplab(aes(label=c(1:179)), size= 2, align = T, linetype = 'blank',
#         na.rm=FALSE, offset=0.2) +
#display/check node labels:
#geom_text2(aes(subset=!isTip, label=node), hjust=-.3)+
#highlight specified node:
#geom_hilight(node=101,fill="yellow", alpha=.6)+
xlim(0,0.75)
filename = paste(gsub(":", "-", Sys.time()),"_names_hosts_nj.pdf",sep="")
ggsave(filename, width = 60, height = 40, units = "cm", limitsize = FALSE)
#ape:
nj.gg <- unroot(nj.gg)
ggtree(nj.gg, ladderize=T, aes(), show.legend = TRUE)+
#%<+% hosts.df %<+% df  +
#name tip labels:
geom_tiplab(cex=0.9)+
#geom_tiplab(aes(), hjust=0, offset=0, align=T, linetype = "dashed" )+
#host tip labels:
#  geom_tiplab(aes(label=hosts.df$hosts), align = T, linetype = 'blank',
#              na.rm=FALSE, offset=0.2) +
#scale
geom_treescale(x=0.05, y=25, offset=2, fontsize = 3)+
#numbered tip labels for checking data addition
#geom_tiplab(aes(label=c(1:179)), size= 2, align = T, linetype = 'blank',
#         na.rm=FALSE, offset=0.2) +
#display/check node labels:
#geom_text2(aes(subset=!isTip, label=node), hjust=-.3)+
#highlight specified node:
#geom_hilight(node=101,fill="yellow", alpha=.6)+
xlim(0,0.75)
filename = paste(gsub(":", "-", Sys.time()),"_names_hosts_nj.pdf",sep="")
ggsave(filename, width = 60, height = 40, units = "cm", limitsize = FALSE)
cacti.nj$tip.label
cacti.njtree$tip.label
aln.bin
?aln.bin
cvx.metadata[1]
cvx.metadata[,1]
cvx.metadata$Name[1]
cvx.metadata$Name[4]
cvx.metadata$Name[70]
cvx.metadata$Name[11]
cvx.metadata$Name[11:69]
cvx.metadata$Organism[11:69]
cvx.metadata$Organism[11] <- NA
cvx.metadata$Organism[11:69]
cvx.metadata$Organism[11:69] <- NA
cvx.metadata$Name[75]
cvx.metadata$Description[75]
cvx.metadata$Description[73]
cvx.metadata$Description[74]
cvx.metadata$Description[74:77]
cvx.metadata$Description[74:78]
cvx.metadata$Description[74:77]
cvx.metadata$Organism[74:77]
cvx.metadata$Organism[74:77] <- "Zygocactus virus X"
which(cvx.metadata$Name== "MH423501")
cvx.metadata$Description[96]
cvx.metadata$Description[95]
cvx.metadata$Organism[95] <- "Mytcor virus 1"
which(cvx.metadata$Name== "20
Schlumbergera_SF19-1_sty_S45_potexvirus - NC_002815 consensus sequence")
which(cvx.metadata$Name== "Schlumbergera_SF19-1_sty_S45_potexvirus - NC_002815 consensus sequence")
cvx.metadata$Organism[97:106] <- NA
#alphabetize metadata, only needs to be done once:
#cvx.metadata <- cvx.metadata[order(cvx.metadata$Name),]
write(x=seq.metadata.csv, file='seq.metadata.csv')
cacti.njtree$tip.label[2]
?gsub
cacti.njtree$tip.label[3]
cvx.metadata$Name[1]
cvx.metadata$Name[2]
cvx.metadata$Name[6]
cvx.metadata$Name[24]
gsub(" ", "_", cvx.metadata$Name[24])
unlink("aln.fasta")
unlink("cacti.njtree.nwk")
